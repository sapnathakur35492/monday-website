<div class="inline-block text-lg font-medium text-slate-700 leading-relaxed">
    {% for token in tokens %}
    {% if token.type == 'text' %}
    <span class="text-slate-500 mx-0.5">{{ token.content }}</span>

    {% elif token.type == 'field' %}
    {% with field=token.field %}
    <div class="inline-flex items-center mx-1 relative group align-baseline" x-data="{ open: false, selected: '' }">
        <input type="hidden" name="{{ prefix }}{{ field.name }}" x-model="selected">

        {% if field.type == 'column' %}
        <!-- Column Selector -->
        {% with cols=board.columns.all %}
        <button type="button" @click="open = !open"
            class="px-2 py-0.5 rounded bg-slate-100 border-b-2 border-slate-300 text-slate-700 hover:bg-slate-200 transition-all font-bold text-base"
            x-text="selected ? (document.getElementById('col-{{ prefix }}-'+selected)?.innerText || selected) : '[{{ field.label }}]'">
            [{{ field.label }}]
        </button>

        <div x-show="open" @click.outside="open = false"
            class="absolute top-full left-0 mt-2 w-56 bg-white rounded-xl shadow-xl ring-1 ring-black/5 z-50 overflow-hidden"
            style="display: none;">
            <div class="max-h-56 overflow-y-auto">
                {% for col in cols %}
                {% if field.param and col.type != field.param %}
                {% else %}
                <div @click="selected = '{{ col.id }}'; open = false" id="col-{{ prefix }}-{{ col.id }}"
                    class="px-4 py-2 hover:bg-slate-50 cursor-pointer text-sm font-medium flex items-center gap-2">
                    <span class="text-xs uppercase text-slate-400">[{{ col.type }}]</span>
                    <span>{{ col.title }}</span>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endwith %}

        {% elif field.type == 'value' %}
        <input type="text" x-model="selected" placeholder="{{ field.label }}"
            class="px-2 py-0.5 w-32 rounded bg-white border-b-2 border-indigo-200 focus:border-indigo-500 focus:outline-none text-indigo-700 font-bold text-base placeholder-indigo-300">

        {% elif field.type == 'group' %}
        <button type="button" @click="open = !open"
            class="px-2 py-0.5 rounded bg-yellow-50 border-b-2 border-yellow-200 text-yellow-700 hover:bg-yellow-100 transition-all font-bold text-base"
            x-text="selected ? (document.getElementById('grp-{{ prefix }}-'+selected)?.innerText || selected) : '[{{ field.label }}]'">
            [{{ field.label }}]
        </button>

        <div x-show="open" @click.outside="open = false"
            class="absolute top-full left-0 mt-2 w-56 bg-white rounded-xl shadow-xl ring-1 ring-black/5 z-50 overflow-hidden"
            style="display: none;">
            {% for grp in board.groups.all %}
            <div @click="selected = '{{ grp.id }}'; open = false" id="grp-{{ prefix }}-{{ grp.id }}"
                class="px-4 py-2 hover:bg-yellow-50 cursor-pointer text-sm font-medium flex items-center gap-2">
                <span class="w-3 h-3 rounded-full" style="background-color: {{ grp.color }}"></span>
                {{ grp.title }}
            </div>
            {% endfor %}
        </div>

        {% elif field.type == 'user' %}
        <button type="button" @click="open = !open"
            class="px-2 py-0.5 rounded bg-blue-50 border-b-2 border-blue-200 text-blue-700 hover:bg-blue-100 transition-all font-bold text-base"
            x-text="selected ? (document.getElementById('usr-{{ prefix }}-'+selected)?.innerText || selected) : '[{{ field.label }}]'">
            [{{ field.label }}]
        </button>

        <div x-show="open" @click.outside="open = false"
            class="absolute top-full left-0 mt-2 w-56 bg-white rounded-xl shadow-xl ring-1 ring-black/5 z-50 overflow-hidden"
            style="display: none;">
            {% with members=board.workspace.organization.memberships.all %}
            {% for mem in members %}
            <div @click="selected = '{{ mem.user.id }}'; open = false" id="usr-{{ prefix }}-{{ mem.user.id }}"
                class="px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm font-medium flex items-center gap-2">
                <div class="w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center text-xs">{{
                    mem.user.username|slice:":1" }}</div>
                {{ mem.user.username }}
            </div>
            {% endfor %}
            {% endwith %}
        </div>

        {% elif field.type == 'text' %}
        <input type="text" name="{{ prefix }}{{ field.name }}" x-model="selected" placeholder="{{ field.label }}"
            class="px-2 py-0.5 w-64 rounded bg-white border-b-2 border-slate-200 focus:border-indigo-500 focus:outline-none text-slate-700 font-medium text-base">

        {% else %}
        <input type="text" name="{{ prefix }}{{ field.name }}" placeholder="{{ field.label }}"
            class="px-2 py-1 rounded bg-slate-50 border border-slate-200 text-sm">
        {% endif %}
    </div>
    {% endwith %}
    {% endif %}
    {% endfor %}
</div>