{% extends "webapp/base_app.html" %}
{% load webapp_tags %}

{% block app_content %}
<div class="p-4 md:p-6 bg-slate-50 min-h-screen">
    <!-- Board Header -->
    <div class="mb-8">
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-4">
            <div class="flex items-center gap-2 text-sm text-slate-500">
                <a href="{% url 'dashboard' %}" class="hover:text-indigo-600">Workspaces</a>
                <span>/</span>
                <span>{{ board.workspace.name }}</span>
            </div>
            <div class="flex gap-2 self-start md:self-auto">
                <a href="{% url 'automation_list' board.id %}"
                    class="flex items-center gap-2 px-3 py-1.5 bg-white border border-slate-300 rounded-md text-slate-700 hover:bg-slate-50 transition-colors text-sm font-medium shadow-sm">
                    <svg class="h-4 w-4 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    Automate
                </a>
            </div>
        </div>

        <div class="mb-6 flex flex-col md:flex-row justify-between md:items-end gap-4">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-slate-900">{{ board.name }}</h1>
                <p class="text-slate-600 mt-1">{{ board.description }}</p>
            </div>
            <div class="flex items-center gap-3 w-full md:w-auto">
                <form method="GET" class="relative w-full md:w-auto">
                    <input type="text" name="search" value="{{ search_query|default:'' }}" placeholder="Search items..."
                        class="pl-9 pr-4 py-2 border border-slate-300 rounded-md text-sm focus:ring-indigo-500 focus:border-indigo-500 w-full md:w-64 shadow-sm">
                    <svg class="h-4 w-4 text-slate-400 absolute left-3 top-3" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </form>
            </div>
        </div>

        <!-- Views Tabs -->
        <div class="border-b border-slate-200 overflow-x-auto">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                <a href="#"
                    class="border-indigo-500 text-indigo-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
                    aria-current="page">Main Table</a>
                <a href="{% url 'board_kanban' board.id %}"
                    class="border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Kanban</a>
                <a href="{% url 'board_calendar' board.id %}"
                    class="border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Calendar</a>
            </nav>
        </div>
    </div>

    <!-- Groups Loop -->
    <div class="space-y-12">
        {% for group in board.groups.all %}
        <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden">
            <!-- Group Header -->
            <div class="p-4 border-b border-slate-200 flex items-center gap-3"
                style="border-left: 6px solid {{ group.color }};">
                <span class="font-semibold text-lg text-slate-800">{{ group.title }}</span>
                <span class="text-xs font-mono bg-slate-100 px-2 py-1 rounded text-slate-500">{{ group.items.count }}
                    items</span>
            </div>

            <!-- Items Table -->
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm min-w-[1000px]">
                    <thead class="bg-slate-50 text-slate-500 font-medium">
                        <tr>
                            <th class="px-4 py-3 border-r border-slate-200 last:border-0 w-8"></th>
                            <th class="px-4 py-3 border-r border-slate-200 last:border-0 min-w-[300px]">Item</th>

                            {% for col in columns %}
                            <th class="px-4 py-3 border-r border-slate-200 last:border-0 w-40 text-center">
                                {{ col.title }}
                            </th>
                            {% endfor %}

                            <th class="px-4 py-3 w-10"></th>
                        </tr>
                    </thead>
                    <tbody id="group-{{ group.id }}-items">
                        {% for item in group.items.all %}
                        {% include "webapp/partials/item_row.html" %}
                        {% endfor %}
                    </tbody>
                    <tfoot class="bg-slate-50">
                        <tr>
                            <td class="border-r border-slate-200" style="border-left: 6px solid {{ group.color }}"></td>
                            <td class="p-0 border-r border-slate-200">
                                <form hx-post="{% url 'add_item' group.id %}" hx-target="#group-{{ group.id }}-items"
                                    hx-swap="beforeend" class="flex"
                                    onsubmit="if(this.name.value.trim() === '') return false;">
                                    {% csrf_token %}
                                    <input type="text" name="name" placeholder="+ Add Item" required
                                        class="w-full px-4 py-2 bg-transparent focus:bg-white focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 placeholder-slate-400">
                                    <button type="submit" class="hidden">Add</button>
                                </form>
                            </td>
                            {% for col in columns %}
                            <td class="border-r border-slate-200"></td>
                            {% endfor %}
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock app_content %}